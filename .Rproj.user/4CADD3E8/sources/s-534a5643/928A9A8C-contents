library(purrr)
library(tidyverse)
library(showtext)
# read in and clean data for modeling

# get list of CSVs
all_files <- list.files('gather_data')
csv_names <- all_files[grepl('.csv', all_files)]

read_and_label <- function(file_name){
  read_csv(paste0('gather_data/', file_name)) %>% 
    mutate(
      recording_id = paste(
          str_replace(recording_num, 'gesture ', ''),
          str_replace_all(file_name, '.csv|movement_data_', ''),
          sep = '_'
       )
    ) %>% 
    select(-recording_num)
}


# load all data into a dataframe
data <- csv_names %>% 
  map_df(read_and_label) %>% 
  mutate(caster = ifelse(is.na(caster), 'Nick', caster))

data$recording_id %>% unique() %>% length()

# plot class distributions
data %>% 
  group_by(label, recording_id) %>% 
  summarise() %>% 
  group_by(label) %>% 
  summarise(observations = n()) %>% 
  ggplot(aes(x = label, y = observations)) +
  geom_bar(stat = 'identity')
  

ggplot(data, aes(x = time, y = accel, color = direction, group = recording_id)) +
  geom_line(alpha = 0.15) +
  facet_wrap(~label) +
  theme_void() +
  theme(strip.text = element_text(family = "Amatic SC"))

data %>% write_csv('spell_data.csv')
